# Plan: Production Readiness

**Created:** 2026-01-19
**Updated:** 2026-01-21
**Status:** Complete
**Goal:** Make @cognigy/chat-components-vue ready for npm publication

---

## Current State

| Metric | Value |
|--------|-------|
| Components | 16 (6 common + 10 message types) |
| Composables | 5 (useMessageContext, useSanitize, useImageContext, useChannelPayload, useCollation) |
| Tests | 444 passing |
| Build | Working (ES module + TypeScript declarations + CSS) |
| Version | 0.1.0 |

---

## Phase 1: Package Metadata ✅ COMPLETE

### 1.1 Package.json Fields ✅

Added:
- `license`: MIT
- `repository`: github.com/Cognigy/chat-components-vue
- `homepage`, `bugs`: GitHub links
- `keywords`: vue, vue3, chat, components, cognigy, webchat, messaging
- `publishConfig`: npm registry with public access
- `sideEffects`: CSS files marked for tree-shaking optimization

### 1.2 CSS Export ✅

Exports configured:
```typescript
import '@cognigy/chat-components-vue/style.css'
```

### 1.3 CHANGELOG.md ✅

Auto-generated by `auto-version.yml` workflow on first release.

---

## Phase 2: Documentation ✅ COMPLETE

### 2.1 README ✅

- [x] Installation instructions
- [x] Badges (npm, license, Node.js, Vue, TypeScript)
- [x] CSS import documented
- [x] Quick start example
- [x] Component tables with links
- [x] Custom plugin example
- [x] Link to React version

### 2.2 API Documentation ✅

Exists in `docs/`:
- `docs/components/README.md` - Component overview with status
- `docs/components/*.md` - Individual component docs (16 files)
- `docs/composables/use-sanitize.md` - Composable docs
- `docs/data-structures/README.md` - Backend integration guide

### 2.3 Examples ✅ COMPLETE

Created `examples/` directory with:
- `BasicChat.vue` - Basic chat integration
- `CustomPlugin.vue` - Creating custom message plugins
- `WithCollation.vue` - Using stream collation
- `Theming.vue` - CSS customization
- `README.md` - Examples overview

---

## Phase 3: Missing Composables ✅ COMPLETE

### 3.1 useCollation ✅

Created `src/composables/useCollation.ts`:
- Collates consecutive bot text messages
- Respects `collateStreamedOutputs` config option
- Reactive computed with `collatedMessages`, `originalCount`, `collatedCount`
- 15 tests passing

### 3.2 useChannelPayload ✅

Created `src/composables/useChannelPayload.ts`:
- Reactive wrapper for `getChannelPayload` utility
- Extracts correct channel payload (_webchat, _defaultPreview, _facebook)
- Helpers: `hasPayload`, `hasQuickReplies`, `hasAttachment`, `attachmentType`
- 14 tests passing

---

## Phase 4: Incomplete Features ⏳ DEFERRED

### 4.1 Conversation State Handling

Components with TODOs for "conversation ended" checks:
- `GalleryItem.vue`
- `List.vue`
- `TextWithButtons.vue`
- `ListItem.vue`

**Status:** Deferred - This is application state, not presentation layer concern.
Consumers can disable buttons by controlling their own state.

---

## Phase 5: CI/CD ✅ COMPLETE

### 5.1 GitHub Actions Workflows ✅

Created:
- `.github/workflows/test.yml` - Runs on PRs: lint, type-check, test, build
- `.github/workflows/auto-version.yml` - Runs on merge to main: version bump, tag, release, npm publish

### 5.2 Automated Versioning ✅

- Minor bump for regular PRs (0.x.0 → 0.(x+1).0)
- Patch bump for Dependabot PRs (0.x.y → 0.x.(y+1))
- Auto-generates CHANGELOG.md entries
- Creates GitHub releases
- Publishes to npm using `COGNIGY_NPM_AUTH_CONFIG` secret

---

## Phase 6: Bundle Optimization ✅ COMPLETE

### 6.1 Tree-shaking Configuration ✅

- Added `sideEffects: ["**/*.css"]` to package.json
- ES module output format (tree-shakeable by default)
- External dependencies (vue, socket-client) not bundled

### 6.2 Bundle Size

| Output | Size | Gzip |
|--------|------|------|
| JavaScript | 390 KB | 117 KB |
| CSS | 38 KB | 7 KB |

---

## Release Readiness Summary

### Ready for Release ✅

| Item | Status |
|------|--------|
| Package metadata | ✅ Complete |
| npm configuration | ✅ Complete |
| CI/CD workflows | ✅ Complete |
| README (public-facing) | ✅ Complete |
| Component documentation | ✅ Complete |
| Composables | ✅ Complete (5 composables) |
| Examples | ✅ Complete (4 examples) |
| Tree-shaking | ✅ Configured |
| Tests passing | ✅ 444 tests |
| Build working | ✅ ES module + types + CSS |

### Deferred

| Item | Reason |
|------|--------|
| Conversation state handling | Application concern, not presentation layer |

---

## Verification Checklist

Before release (automated by CI):

- [x] `npm run lint` passes
- [x] `npm run type-check` passes
- [x] `npm test` passes (444 tests)
- [x] `npm run build` succeeds

Manual verification (recommended):

- [ ] `npm pack` creates valid tarball
- [ ] Test tarball in separate project
- [ ] Verify CSS imports work
- [ ] Verify TypeScript types resolve

---

## External Dependencies ✅ RESOLVED

| Decision | Resolution |
|----------|------------|
| License | MIT |
| Repository URL | github.com/Cognigy/chat-components-vue |
| npm Organization | @cognigy scope (org-wide secret available) |
| Registry | npm only (company standard) |

---

## Next Steps

1. **Merge current branch** to trigger first automated release
2. **Verify npm publish** succeeds with org secret
3. **Test installation** in consuming project
4. **Address feedback** from real-world usage
